package com.cpa.repository;

import java.sql.Connection;
import java.sql.Date;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.ArrayList;

import com.cpa.connectionpooling.DBManager;
import com.cpa.entity.Transaction;
import com.cpa.exception.CPException;

public class TransRepo {

	
	
	//FUNCTION TO RETRIEVE ALL ENTRIES IN CUSTOMER TABLE
		public ArrayList<Transaction> getAllTransactions() {

			DBManager dbm = null;
			Connection con = null;
			Statement st = null;
			ResultSet rs = null;
			ArrayList<Transaction> tranList = new ArrayList<Transaction>();

			int flag = 1;

			try {

				dbm = DBManager.getDBManager();
				con = dbm.getConnection();
				st = con.createStatement();
				rs = st.executeQuery("select * from transaction");
				
				// final String SQL_LAST_ENTRY = "SELECT account_number FROM customer WHERE
				// cust_seq_id=(SELECT MAX(cust_seq_id) FROM customer)";
				// rs = st.executeQuery(SQL_LAST_ENTRY);
				// System.out.println(SQL_LAST_ENTRY);
				while (rs.next()) {
					Transaction transaction = new Transaction();
					
					int db_cust_seq_id = rs.getInt("cust_seq_id");
					transaction.setCust_seq_id(db_cust_seq_id);
					
					Date db_tran_date = rs.getDate("tran_date");
					transaction.setTran_date(db_tran_date);
					
					String db_tran_details = rs.getString("tran_details");
					transaction.setTran_details(db_tran_details);
					
					Double db_credit_amt = rs.getDouble("credit_amt");
					transaction.setCredit_amt(db_credit_amt);
					
					
					tranList.add(transaction);
					
				


				}
			} catch (CPException exp) {
				exp.printStackTrace();
			} catch (Exception exp1) {
				exp1.printStackTrace();
			} finally {
				dbm.closeConnection(con);
				try {
					rs.close();
					st.close();
				} catch (Exception exp) {

				}
			}
			return tranList ;

		}
}
